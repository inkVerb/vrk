#!/bin/sh
#inkVerbSurfer! verb.ink

# This sets the Vubuntu Desktop preferences for a Vubuntu installation.
## Prerequesite: Vrkâ„¢ must be installed

## To observe terminal commands that create these settings while using GUI: dconf watch /

# How to use:
## set-mi-desktop

# Eg: (re-install for specific desktop)
## set-mi-desktop $DESKTOP_SESSION


# Set
## Vall room
VALL_ROOM="vrk"
## Vall background
VALL_BACKGRND="Get-to-Vrk.png"
## Vall lockscreen
VALL_LOCKSRN="Vrk-Mesh-Disk.png"

# Check to make sure this not run as sudo or root
if [ "$(id -u)" = "0" ]; then
/usr/bin/echo "Do not run as root or sudo."; exit 22
fi

# Check if Vrk installed on this machine
if [ ! -f /opt/vrk/machineinfo ]; then
/usr/bin/echo "Install Vrk first. See README.md"
exit 22
fi

# Check if Vrk installed to user
if [ ! -f ~/.vrk/configs/stationinfo ]; then
/usr/bin/echo "First, run install-vrk for this user. See README.md"; exit 22
fi

# Check if Vrk Desktop is already set for this user
. ~/.vrk/configs/stationinfo
if [ "${VRK_DESKTOP_SET}" = "YES" ]; then
/usr/bin/echo "Vrk Desktop already set for this user.

Type \"yes\" to run it again, anything else to quit...
"
read YESRESET
 if [ "${YESRESET}" != "yes" ]; then
exit 0
 fi
fi

# Include the config
. /opt/vrk/machineinfo

# Change the Distro variable if re-installing per-desktop
if [ -n "$1" ]; then
LINUX_DESKTOP="$1"; fi


# Distro version
release_num=$(lsb_release -r -s)

# Global exceptions tests
if [ "$LINUX_DESKTOP" = "xfce" ]; then
DESKTOP_GLOBE="EXCEPTION"; fi

# Global

## Terminal
/usr/bin/chsh -s /bin/bash
/usr/bin/cp ~/.bashrc ~/.bashrc-vrkbak
## Make the prompt setting like this: # PS1='\[\033[01;32m\][\u@\h\[\033[01;37m\] \[\033[01;34m\]\w\[\033[01;32m\]]\$\[\033[00m\] '
/usr/bin/sed -i "s:\\\W:\\\[\\\033[01;34m\\\]\\\w:g" ~/.bashrc
/usr/bin/echo "
# Gnome Text Editor shortcut
alias vedit=gnome-text-editor
export EDITOR='vim'
export VISUAL='gnome-text-editor'
" >> ~/.bashrc

## Wayland
/usr/bin/cat <<EOF >> ~/.bashrc

# Wayland
## QT5 Fix
export QT_QPA_PLATFORMTHEME="qt5ct"

## Wayland Fix
export QT_QPA_PLATFORM=wayland
EOF

## Templates
~/.vrk/boards/do-vrktemplates

## Gedit (may be redundant in per-environments below, but just be safe)
/usr/bin/gsettings set org.gnome.gedit.preferences.editor display-line-numbers true
/usr/bin/gsettings set org.gnome.gedit.preferences.editor highlight-current-line true
/usr/bin/gsettings set org.gnome.gedit.preferences.editor bracket-matching true
/usr/bin/gsettings set org.gnome.gedit.preferences.editor scheme 'solarized-dark'

# Setup Vim for copy to clipboard
/usr/bin/echo 'nnoremap <C-c> "+y
vnoremap <C-c> "+y
nnoremap <C-p> "+p
vnoremap <C-p> "+p
syntax on
set number' > ~/.vimrc

## Pause to avoid trouble
/usr/bin/sleep 1

# Global #

# GNOME
if [ "$LINUX_DESKTOP" = "gnome" ]; then

# Desktop
## Notes:
# - Compose: CapsLock
# - Activities: Top left corner mouse; Super
# - Applications: Ctrl + Left Super
# - New window: middle click on menu's app icon
# - Minimize: middle click on title bar
# - Move window: Alt + click anywhere
# - Scale window: Alt + right click near edge or corner
/usr/bin/gsettings set org.gnome.desktop.input-sources xkb-options "['compose:caps']"
/usr/bin/gsettings set org.gnome.desktop.wm.keybindings close "['<Alt>F4']"
/usr/bin/gsettings set org.gnome.desktop.wm.preferences resize-with-right-button true
/usr/bin/gsettings set org.gnome.desktop.wm.preferences mouse-button-modifier '<Alt>'
/usr/bin/gsettings set org.gnome.desktop.wm.preferences action-middle-click-titlebar 'minimize'
/usr/bin/gsettings set org.gnome.desktop.wm.preferences button-layout ':minimize,close'
/usr/bin/gsettings set org.gnome.desktop.screensaver lock-enabled false
/usr/bin/gsettings set org.gnome.desktop.wm.preferences focus-new-windows 'smart'
/usr/bin/gsettings set org.gnome.desktop.interface clock-show-weekday true
/usr/bin/gsettings set org.gnome.desktop.interface clock-show-date true
/usr/bin/gsettings set org.gnome.desktop.interface toolbar-detachable false
/usr/bin/gsettings set org.gnome.desktop.notifications show-banners false
/usr/bin/gsettings set org.gnome.desktop.notifications show-in-lock-screen false
/usr/bin/gsettings set org.gnome.mutter workspaces-only-on-primary false
/usr/bin/gsettings set org.gnome.desktop.interface enable-hot-corners true
/usr/bin/gsettings set org.gnome.shell.app-switcher current-workspace-only true
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.power power-button-action 'interactive'
/usr/bin/gsettings set org.gnome.shell.keybindings toggle-application-view "['<Ctrl>Super_L']"
/usr/bin/gsettings set org.gnome.shell.keybindings toggle-overview "['<Super>']"
/usr/bin/gsettings set org.gnome.desktop.background show-desktop-icons true
/usr/bin/dconf write /org/gtk/gtk4/settings/file-chooser/sort-directories-first true

# Workspace switching (defaults)
/usr/bin/gsettings set org.gnome.desktop.wm.keybindings move-to-workspace-left "['<Control><Alt>Left']"
/usr/bin/gsettings set org.gnome.desktop.wm.keybindings move-to-workspace-right "['<Control><Alt>Right']"
/usr/bin/gsettings set org.gnome.desktop.wm.keybindings move-to-workspace-up "['<Control><Alt>Up']"
/usr/bin/gsettings set org.gnome.desktop.wm.keybindings move-to-workspace-down "['<Control><Alt>Down']"

# Password anytime screen turns back on (from lock or suspend)
/usr/bin/gsettings set org.gnome.desktop.screensaver lock-enabled true

# Set Lockscreen to "never" (uint32 0)
/usr/bin/gsettings set org.gnome.desktop.session idle-delay "uint32 0"
#gsettings set org.gnome.desktop.session idle-delay "uint32 900" # 15 minutes
#gsettings set org.gnome.desktop.session idle-delay "uint32 600" # 5 minutes

# # Screensaver settings
# /usr/bin/xscreensaver-settings
# /usr/bin/killall xscreensaver-settings
# /usr/bin/killall xscreensaver > /dev/null 2>&1
# /usr/bin/sed -i "s/^unfade:.*/unfade:         False/" ~/.xscreensaver
# /usr/bin/sed -i "s/^fade:.*/fade:         False/" ~/.xscreensaver
# /usr/bin/sed -i "s/^mode:.*/mode:           one/" ~/.xscreensaver
# /usr/bin/sed -i "s/^selected:.*/selected:       $(/usr/bin/grep -wn helios ~/.xscreensaver | /usr/bin/cut -d: -f1)/" ~/.xscreensaver

# ArcMenu
/usr/bin/gnome-extensions enable arcmenu@arcmenu.com
/usr/bin/gsettings set org.gnome.shell.extensions.arcmenu menu-button-icon 'Distro_Icon'
#gsettings set org.gnome.shell.extensions.arcmenu menu-button-icon 'Arc_Menu_Icon'
/usr/bin/gsettings set org.gnome.shell.extensions.arcmenu multi-monitor true
/usr/bin/gsettings set org.gnome.shell.extensions.arcmenu arcmenu-hotkey 'Super_R'

# Set theme & icons
# Desktop theme for legacy applications
/usr/bin/gsettings set org.gnome.desktop.interface gtk-theme 'Adwaita-dark'
/usr/bin/gsettings set org.gnome.desktop.interface icon-theme 'Papirus-Adapta-Nokto-Maia'
/usr/bin/gsettings set org.gnome.shell.extensions.user-theme name 'Adwaita-dark'

# OnlyOffice to dark theme
/usr/bin/sed -i "s/UITheme=theme-.*/UITheme=theme-dark/" ~/.config/onlyoffice/DesktopEditors.conf

# Inkscape to dark theme
/usr/bin/killall inkscape
/usr/bin/sed -i 's/gtkTheme=.*/gtkTheme="Adwaita-maia-dark"/' ~/.config/inkscape/preferences.xml
/usr/bin/grep -qF 'gtkTheme="Adwaita-maia-dark"' ~/.config/inkscape/preferences.xml || /usr/bin/sed -i 's/gtkTheme=.*/gtkTheme="Adwaita-dark"/' ~/.config/inkscape/preferences.xml

# Dash to Panel (replaces Dash to Dock)
/usr/bin/gnome-extensions disable dash-to-dock@micxgx.gmail.com
/usr/bin/gnome-extensions enable dash-to-panel@jderose9.github.com
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel isolate-monitors false
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel hide-overview-on-startup true
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel multi-monitors true
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel panel-element-positions-monitors-sync true
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel primary-monitor 0
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel intellihide true
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel intellihide-use-pressure false
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel intellihide-show-in-fullscreen false
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel intellihide-only-secondary true
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel panel-size 32
#gsettings set org.gnome.shell.extensions.dash-to-panel panel-sizes '{"0":32,"1":32,"2":32,"3":32}'
#gsettings set org.gnome.shell.extensions.dash-to-panel panel-positions '{"0":"TOP","1":"TOP","2":"TOP","3":"TOP"}'
#gsettings set org.gnome.shell.extensions.dash-to-panel panel-lengths '{"0":100,"1":100,"2":100}'
#gsettings set org.gnome.shell.extensions.dash-to-panel panel-element-positions '{"0":[{"element":"showAppsButton","visible":false,"position":"stackedTL"},{"element":"activitiesButton","visible":false,"position":"stackedTL"},{"element":"leftBox","visible":true,"position":"stackedTL"},{"element":"taskbar","visible":true,"position":"stackedTL"},{"element":"centerBox","visible":true,"position":"stackedBR"},{"element":"rightBox","visible":true,"position":"stackedBR"},{"element":"dateMenu","visible":true,"position":"stackedBR"},{"element":"systemMenu","visible":true,"position":"stackedBR"},{"element":"desktopButton","visible":true,"position":"stackedBR"}],"1":[{"element":"showAppsButton","visible":false,"position":"stackedTL"},{"element":"activitiesButton","visible":false,"position":"stackedTL"},{"element":"leftBox","visible":true,"position":"stackedTL"},{"element":"taskbar","visible":true,"position":"stackedTL"},{"element":"centerBox","visible":true,"position":"stackedBR"},{"element":"rightBox","visible":true,"position":"stackedBR"},{"element":"dateMenu","visible":true,"position":"stackedBR"},{"element":"systemMenu","visible":true,"position":"stackedBR"},{"element":"desktopButton","visible":true,"position":"stackedBR"}],"2":[{"element":"showAppsButton","visible":false,"position":"stackedTL"},{"element":"activitiesButton","visible":false,"position":"stackedTL"},{"element":"leftBox","visible":true,"position":"stackedTL"},{"element":"taskbar","visible":true,"position":"stackedTL"},{"element":"centerBox","visible":true,"position":"stackedBR"},{"element":"rightBox","visible":true,"position":"stackedBR"},{"element":"dateMenu","visible":true,"position":"stackedBR"},{"element":"systemMenu","visible":true,"position":"stackedBR"},{"element":"desktopButton","visible":true,"position":"stackedBR"}]}'
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel panel-sizes '{"0":32}'
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel panel-positions '{"0":"TOP"}'
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel panel-position 'TOP'
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel panel-lengths '{"0":100}'
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel panel-element-positions '{"0":[{"element":"showAppsButton","visible":false,"position":"stackedTL"},{"element":"activitiesButton","visible":false,"position":"stackedTL"},{"element":"leftBox","visible":true,"position":"stackedTL"},{"element":"taskbar","visible":true,"position":"stackedTL"},{"element":"centerBox","visible":true,"position":"stackedBR"},{"element":"rightBox","visible":true,"position":"stackedBR"},{"element":"dateMenu","visible":true,"position":"stackedBR"},{"element":"systemMenu","visible":true,"position":"stackedBR"},{"element":"desktopButton","visible":true,"position":"stackedBR"}]}'
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel show-appmenu false
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel show-activities-button false
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel show-favorites true
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel show-favorites-all-monitors true
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel isolate-monitors true
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel isolate-workspaces true
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel middle-click-action 'LAUNCH'
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel show-favorites true
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel show-favorites-all-monitors true
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel dot-style-focused 'CILIORA'
/usr/bin/gsettings set org.gnome.shell.extensions.dash-to-panel dot-style-unfocused 'CILIORA'
/usr/bin/gsettings set org.gnome.shell.extensions.arcmenu gnome-dash-show-applications false

## Spotify bugs (GNOME only)
/usr/bin/dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.PlayPause
/usr/bin/dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Stop
/usr/bin/dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Next
/usr/bin/dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Previous

# Gedit settings
/usr/bin/gsettings set org.gnome.gedit.preferences.editor display-overview-map true
/usr/bin/gsettings set org.gnome.gedit.preferences.editor wrap-mode none

# GNOME Text Editor
/usr/bin/echo 'alias vedit=gnome-text-editor' >> ~/.bashrc
/usr/bin/gsettings set org.gnome.TextEditor style-variant 'dark'
/usr/bin/gsettings set org.gnome.TextEditor style-scheme 'kate-dark'
#gsettings set org.gnome.TextEditor style-scheme 'Adwaita-dark' # Default
/usr/bin/gsettings set org.gnome.TextEditor highlight-current-line true
/usr/bin/gsettings set org.gnome.TextEditor show-map true
/usr/bin/gsettings set org.gnome.TextEditor show-line-numbers true
/usr/bin/gsettings set org.gnome.TextEditor wrap-text false
/usr/bin/gsettings set org.gnome.TextEditor restore-session false
/usr/bin/gsettings set org.gnome.TextEditor spellcheck false

# Codium Themes & extensions (if installed)
if /usr/bin/codium -h > /dev/null && 2>&1; then
    /usr/bin/codium --install-extension emroussel.atomize-atom-one-dark-theme
    /usr/bin/codium --install-extension opensumi.opensumi-default-themes
    /usr/bin/codium --install-extension PenumbraTheme.penumbra
    /usr/bin/codium --install-extension timonwong.shellcheck
    /usr/bin/codium --install-extension ms-vscode.go
fi

# Default text editors
/usr/bin/cat <<EOF >> ~/.bashrc
export EDITOR='vim'
export VISUAL='gnome-text-editor'
EOF

# Prepare 6 custom shortcuts
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys custom-keybindings "['/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom4/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom5/']"

## GNOME Text Editor
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/ name "'GNOME Text Editor'"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/ binding "'<Ctrl><Alt>x'"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/ command "'gnome-text-editor'"

## Calculator
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom4/ name "'Calculator'"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom4/ binding "'<Ctrl><Alt>q'"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom4/ command "'gnome-calculator'"

## Screenshot: Select area
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom5/ name "'Screenshot Selection'"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom5/ binding "'<Ctrl><Shift>Print_Screen'"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom5/ command "'gnome-screenshot -ac'"

# Volume keys (Ctrl + Page Up/Down, Break)
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys volume-up "['<Shift>Page_Up']"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys volume-down "['<Shift>Page_Down']"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys volume-mute "['<Shift>Break']"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys volume-step 3
#gsettings reset org.gnome.settings-daemon.plugins.media-keys volume-up
#gsettings reset org.gnome.settings-daemon.plugins.media-keys volume-down
#gsettings reset org.gnome.settings-daemon.plugins.media-keys volume-mute
#gsettings reset org.gnome.settings-daemon.plugins.media-keys volume-step
#gsettings get org.gnome.settings-daemon.plugins.media-keys volume-up
#gsettings get org.gnome.settings-daemon.plugins.media-keys volume-down
#gsettings get org.gnome.settings-daemon.plugins.media-keys volume-mute
#gsettings get org.gnome.settings-daemon.plugins.media-keys volume-step

# Terminal keyboard shortcuts
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/ name "'Dropdown Terminal: Pause'"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/ binding "'Pause'"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/ command "'xfce4-terminal --drop-down'"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/ name "'Xfce Terminal'"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/ binding "'<Ctrl><Alt>t'"
/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/ command "'xfce4-terminal'"
## DEV these are for reference, but they will conflict with custom2 below for Guake Scroll Lock
#/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/ name "'Dropdown Terminal: Ctrl+F12'"
#/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/ binding "'<Ctrl>f12'"
#/usr/bin/gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/ command "'xfce4-terminal --drop-down'"
#gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/ name "'Gnome Terminal'"
#gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/ binding "'<Ctrl><Alt>t'"
#gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/ command "'gnome-terminal'"

# Guake
/usr/bin/dconf write /org/guake/keybindings/global/show-hide "'Scroll_Lock'"
/usr/bin/dconf write /org/guake/general/window-refocus true
/usr/bin/dconf write /org/guake/general/window-vertical-displacement 40
/usr/bin/dconf write /org/guake/general/use-trayicon false
/usr/bin/dconf write /org/guake/general/start-at-login true
/usr/bin/dconf write /org/guake/general/prompt-on-quit false
/usr/bin/dconf write /org/guake/general/window-height 25
/usr/bin/dconf write /org/guake/general/use-popup false
/usr/bin/dconf write /org/guake/general/gtk-use-system-default-theme true
/usr/bin/dconf write /org/guake/style/font/palette-name "'One Dark'"

# Reiterate the Scroll Lock for Guake (Such as if Wayland isn't deactivated)
gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/ name "'Guake Terminal: Scroll Lock'"
gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/ binding "'Scroll_Lock'"
gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/ command "'guake'"

# X-Terminal Settings
## DropdownPositionVertical=0 makes trouble for F11 & F12 in combinations (fullscreen & show/hide)
/usr/bin/mkdir -p ~/.config/xfce4/terminal
/usr/bin/echo "[Configuration]
FontAllowBold=FALSE
MiscAlwaysShowTabs=FALSE
MiscBell=TRUE
MiscBellUrgent=FALSE
MiscBordersDefault=FALSE
MiscCursorBlinks=FALSE
MiscCursorShape=TERMINAL_CURSOR_SHAPE_BLOCK
MiscDefaultGeometry=80x23
MiscInheritGeometry=FALSE
MiscMenubarDefault=FALSE
MiscMouseAutohide=FALSE
MiscMouseWheelZoom=TRUE
MiscToolbarDefault=FALSE
MiscConfirmClose=TRUE
MiscCycleTabs=TRUE
MiscTabCloseButtons=TRUE
MiscTabCloseMiddleClick=TRUE
MiscTabPosition=GTK_POS_TOP
MiscHighlightUrls=TRUE
MiscMiddleClickOpensUri=TRUE
MiscCopyOnSelect=FALSE
MiscShowRelaunchDialog=TRUE
MiscRewrapOnResize=TRUE
MiscUseShiftArrowsToScroll=FALSE
MiscSlimTabs=TRUE
MiscNewTabAdjacent=FALSE
MiscSearchDialogOpacity=100
MiscShowUnsafePasteDialog=FALSE
MiscRightClickAction=TERMINAL_RIGHT_CLICK_ACTION_CONTEXT_MENU
BackgroundMode=TERMINAL_BACKGROUND_TRANSPARENT
BackgroundDarkness=0.780000
ColorPalette=#0c0d0e;#e31a1c;#31a354;#dca060;#3182bd;#756bb1;#80b1d3;#b7b8b9;#737475;#e31a1c;#31a354;#dca060;#3182bd;#756bb1;#80b1d3;#fcfdfe
DropdownWidth=100
DropdownHeight=25
DropdownStatusIcon=FALSE
FontName=Monospace 11
ShortcutsNoMnemonics=TRUE
ShortcutsNoMenukey=TRUE
ShortcutsNoHelpkey=TRUE
DropdownKeepOpenDefault=TRUE
DropdownToggleFocus=TRUE
DropdownPositionVertical=4
DropdownMoveToActive=TRUE
DropdownKeepAbove=TRUE
" > ~/.config/xfce4/terminal/terminalrc
wait
cat <<EOF > ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-terminal.xml
<?xml version="1.0" encoding="UTF-8"?>

<channel name="xfce4-terminal" version="1.0">
  <property name="background-mode" type="string" value="TERMINAL_BACKGROUND_TRANSPARENT"/>
  <property name="background-darkness" type="double" value="0.73999999999999999"/>
  <property name="misc-borders-default" type="bool" value="false"/>
  <property name="misc-show-unsafe-paste-dialog" type="bool" value="false"/>
  <property name="misc-middle-click-opens-uri" type="bool" value="true"/>
  <property name="dropdown-width" type="uint" value="100"/>
  <property name="dropdown-keep-open-default" type="bool" value="true"/>
  <property name="dropdown-toggle-focus" type="bool" value="true"/>
  <property name="dropdown-keep-above" type="bool" value="true"/>
  <property name="dropdown-status-icon" type="bool" value="false"/>
  <property name="color-foreground" type="string" value="#ffffff"/>
  <property name="color-background" type="string" value="#000000"/>
  <property name="color-background-vary" type="bool" value="false"/>
  <property name="color-cursor-foreground" type="string" value=""/>
  <property name="color-cursor" type="string" value=""/>
  <property name="color-cursor-use-default" type="bool" value="true"/>
  <property name="color-selection" type="string" value=""/>
  <property name="color-selection-background" type="string" value=""/>
  <property name="color-selection-use-default" type="bool" value="true"/>
  <property name="color-bold" type="string" value=""/>
  <property name="color-bold-use-default" type="bool" value="true"/>
  <property name="color-palette" type="string" value="#000000;#cc0000;#4e9a06;#c4a000;#3465a4;#75507b;#06989a;#d3d7cf;#555753;#ef2929;#8ae234;#fce94f;#739fcf;#ad7fa8;#34e2e2;#eeeeec"/>
  <property name="color-bold-is-bright" type="bool" value="true"/>
  <property name="color-use-theme" type="bool" value="false"/>
  <property name="tab-activity-color" type="string" value="#aa0000"/>
  <property name="dropdown-height" type="uint" value="33"/>
  <property name="dropdown-move-to-active" type="bool" value="false"/>
  <property name="dropdown-position-vertical" type="uint" value="4"/>
</channel>
EOF
wait

fi

# GNOME #

# Xfce
## Help:
#http://docs.xfce.org/xfce/xfconf/xfconf-query

if [ "${LINUX_DESKTOP}" = "xfce" ] ; then

## App Defaults
/usr/bin/cp -f ~/.vrk/donjon/global/config/mimeapps.list ~/.config/

## Autostart special
/usr/bin/cp -rf ~/.vrk/donjon/xfce/config/autostart ~/.config/

## Disable lock screen
##DEV may be broken, use xfconf-query
# /usr/bin/gsettings set apps.light-locker late-locking false
# /usr/bin/gsettings set apps.light-locker lock-after-screensaver 0
# /usr/bin/gsettings set apps.light-locker lock-on-suspend true
/usr/bin/xfconf-query -c xfce4-screensaver -np '/lock/enabled' -s 'false'
/usr/bin/xfconf-query -c xfce4-screensaver -np '/saver/enabled' -s 'false'
/usr/bin/xfconf-query -c xfce4-power-manager -np '/xfce4-power-manager/blank-on-ac' -s '0'
/usr/bin/xfconf-query -c xfce4-power-manager -np '/xfce4-power-manager/blank-on-battery' -s '0'
/usr/bin/xfconf-query -c xfce4-power-manager -np '/xfce4-power-manager/blank-on-ac' -s '0'
/usr/bin/xfconf-query -c xfce4-power-manager -np '/xfce4-power-manager/blank-on-battery' -s '0'
/usr/bin/xfconf-query -c xfce4-power-manager -np '/xfce4-power-manager/dpms-enabled' -s 'false'
/usr/bin/xfconf-query -c xfce4-power-manager -np '/xfce4-power-manager/dpms-on-ac-sleep' -s '0'
/usr/bin/xfconf-query -c xfce4-power-manager -np '/xfce4-power-manager/dpms-on-ac-off' -s '0'
/usr/bin/xfconf-query -c xfce4-power-manager -np '/xfce4-power-manager/dpms-on-battery-sleep' -s '0'
/usr/bin/xfconf-query -c xfce4-power-manager -np '/xfce4-power-manager/dpms-on-battery-off' -s '0'

## Mouse cursor theme
/usr/bin/gsettings set org.gnome.desktop.interface cursor-theme "DMZ-Black"

## Desktop prefer dark
/usr/bin/gsettings set org.gnome.desktop.interface color-scheme "prefer-dark"

## Compose Key: CapLock key
/usr/bin/xfconf-query -n -c keyboard-layout -p /Default/XkbOptions/Compose -t string -s "compose:caps"
#xfconf-query -n -c keyboard-layout -p /Default/XkbOptions/Compose -t string -s "compose:menu"

## Set theme & icons
### Window Theme
/usr/bin/xfconf-query -c xfwm4 -p /general/theme -s "Numix"
### Color Theme
/usr/bin/xfconf-query -c xsettings -p /Net/ThemeName -s "Matcha-dark-azul"

## Pause to avoid trouble
/usr/bin/sleep 1

#DEV This has a problem
## Whisker menu
### Icon
/usr/bin/sed -i "s/button-icon=.*/button-icon=\/var\/local\/vall\/rooms\/mi\/icons\/inkVerb-disk-white\.svg/g" ~/.config/xfce4/panel/whiskermenu-1.rc
#### Show it
/usr/bin/sed -i "s/show-button-icon=.*/show-button-icon=true/g" ~/.config/xfce4/panel/whiskermenu-1.rc
### Favorites
/usr/bin/sed -i "s/favorites=.*/favorites=exo-file-manager\.desktop,vivaldi-stable\.desktop,google-chrome\.desktop,chromium-browser\.desktop,firefox\.desktop,gedit\.desktop,libreoffice-writer\.desktop,thunderbird\.desktop,rhythmbox\.desktop,org\.gnome\.Software\.desktop,gnome-calculator\.desktop/g" ~/.config/xfce4/panel/whiskermenu-1.rc
/usr/bin/sed -i "s/favorites-in-recent=.*/favorites-in-recent=false/g" ~/.config/xfce4/panel/whiskermenu-1.rc

## Terminal color scheme
### Check if done
if [ ! -f "~/.vrk/configs/.xt-xfce" ]; then
### Add the theme
~/.vrk/donjon/xt-xfce
### Make the record
/usr/bin/touch ~/.vrk/configs/.xt-xfce
fi

## Workspaces & windows
/usr/bin/xfconf-query -c xfwm4 -p /general/workspace_count -s 3
/usr/bin/xfconf-query -c xfwm4 -p /general/scroll_workspaces -s true
/usr/bin/xfconf-query -c xfwm4 -p /general/mousewheel_rollup -s true
/usr/bin/xfconf-query -c xfwm4 -p /general/tile_on_move -s true

## Wallpaper
#first one already set by set-vall, but let's spice up the rest, shall we...
#xfconf-query -n -t string -c xfce4-desktop -p /backdrop/screen0/monitor0/workspace0/last-image -s /usr/share/xfce4/backdrops/inkPage.png
/usr/bin/xfconf-query -n -t string -c xfce4-desktop -p /backdrop/screen0/monitor1/workspace0/last-image -s /usr/share/xfce4/backdrops/Pen-Black.png
/usr/bin/xfconf-query -n -t string -c xfce4-desktop -p /backdrop/screen0/monitor2/workspace0/last-image -s /usr/share/xfce4/backdrops/Whitetype-Ink-Gray.png
/usr/bin/xfconf-query -n -t string -c xfce4-desktop -p /backdrop/screen0/monitor3/workspace0/last-image -s /usr/share/xfce4/backdrops/inkCorner.png

## Pause to avoid trouble
/usr/bin/sleep 1

## Hot keys
### Ctrl+F12 / Scroll Lock for Xterminal Drop-down
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/<Ctrl>F12" -t string -s 'xfce4-terminal --drop-down'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/Pause" -t string -s 'xfce4-terminal --drop-down'
### Whisker menu
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/Super_L" -t string -s 'xfce4-popup-whiskermenu'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/Super_R" -t string -s 'xfce4-popup-whiskermenu'
#can't use <Super> given the above Super_L and Super_R declarations :-(
#xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/<Super>z" -t string -s 'xfce4-popup-whiskermenu'
#xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/<Super>space" -t string -s 'xfce4-popup-whiskermenu'
#DEV xfdashboard doesn't work
### Xfdashboard
#### set for both orders since order matters
# xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/<Ctrl><Alt>Super_L" -t string -s 'xfdashboard'
# xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/<Ctrl><Alt>Super_R" -t string -s 'xfdashboard'
### Numlock on by default
/usr/bin/xfconf-query -c keyboards -p /Default/RestoreNumlock -n -t bool -s true
/usr/bin/xfconf-query -c keyboards -p /Default/Numlock -n -t bool -s true
### Window tiling
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/xfwm4/custom/<Ctrl><Super>Up" -t string -s 'tile_up_key'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/xfwm4/custom/<Ctrl><Super>Down" -t string -s 'tile_down_key'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/xfwm4/custom/<Ctrl><Super>Left" -t string -s 'tile_left_key'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/xfwm4/custom/<Ctrl><Super>Right" -t string -s 'tile_right_key'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/xfwm4/custom/<Shift><Super>Left" -t string -s 'tile_up_left_key'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/xfwm4/custom/<Shift><Super>Right" -t string -s 'tile_up_right_key'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/xfwm4/custom/<Alt><Super>Left" -t string -s 'tile_down_left_key'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/xfwm4/custom/<Alt><Super>Right" -t string -s 'tile_down_right_key'
### Desktop apps
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/<Super>d" -t string -s 'gedit'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/<Super>e" -t string -s 'thunar'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/<Super>q" -t string -s 'gnome-calculator'
/usr/bin/xfconf-query -n -c xfce4-keyboard-shortcuts -p "/commands/custom/<Ctrl><Alt>t" -t string -s 'xfce4-terminal'

## Pause to avoid trouble
/usr/bin/sleep 1

## Xfdashboard
###DEV see available options: xfconf-query -c xfdashboard -lv
#http://xfdashboard.froevel.de/settings.html
#https://github.com/gmc-holle/xfdashboard/issues/122
## Dashboard settings
/usr/bin/xfconf-query -n -t bool -c xfdashboard -p /always-launch-new-instance -s false
/usr/bin/xfconf-query -n -t bool -c xfdashboard -p /components/applications-view/show-all-apps -s true
/usr/bin/xfconf-query -n -t bool -c xfdashboard -p /components/windows-view/scroll-event-changes-workspace -s true
/usr/bin/xfconf-query -n -t string -c xfdashboard -p /theme -s xfdashboard-dark
## Enable the hot-corner plugin by adding the hot-corner value to enabled-plugins as a new property
/usr/bin/xfconf-query -n -c xfdashboard -p /enabled-plugins -a -t string -s hot-corner
## Enable gnome shell search provider also (this resets all plugins every time)
#xfconf-query -n -c xfdashboard -p /enabled-plugins -a -t string -s hot-corner -t string -s gnome-shell-search-provider
## Settings for hotcorner
/usr/bin/xfconf-query -n -t string -c xfdashboard -p /plugins/hot-corner/activation-corner -s XFDASHBOARD_HOT_CORNER_SETTINGS_ACTIVATION_CORNER_TOP_LEFT
/usr/bin/xfconf-query -n -t string -c xfdashboard -p /plugins/hot-corner/activation-duration -s 27
/usr/bin/xfconf-query -n -t string -c xfdashboard -p /plugins/hot-corner/activation-radius -s 1
## Favorites (spelled British in settings!)
### Defaults:
### xfconf-query -n -t string -c xfdashboard -p /favourites -t string -s "exo-web-browser.desktop" -t string -s "exo-mail-reader.desktop" -t string -s "exo-file-manager.desktop" -t string -s "exo-terminal-emulator.desktop"
### xfconf-query -n -t string -c xfdashboard -p /favourites -t string -s "exo-file-manager.desktop" -t string -s "chromium-browser.desktop" -t string -s "firefox.desktop" -t string -s "thunderbird.desktop" -t string -s "gedit.desktop" -t string -s "libreoffice-writer.desktop" -t string -s "gnome-calculator.desktop" -t string -s "xfce4-settings-manager.desktop"
### xfconf-query -n -c xfdashboard -p /favourites -t string -s "exo-file-manager.desktop" -t string -s "exo-web-browser.desktop" -t string -s "exo-mail-reader.desktop" -t string -s "gedit.desktop" -t string -s "libreoffice-writer.desktop" -t string -s "gnome-calculator.desktop" -t string -s "xfce4-settings-manager.desktop"
### xfconf-query -n -c xfdashboard -p /favourites -t string -s "exo-file-manager.desktop" -t string -s "chromium-browser.desktop" -t string -s "firefox.desktop" -t string -s "thunderbird.desktop" -t string -s "gedit.desktop" -t string -s "libreoffice-writer.desktop" -t string -s "gnome-calculator.desktop" -t string -s "xfce4-settings-manager.desktop"
~/.vrk/donjon/xfdashboard-zilla

## Message
/usr/bin/echo "
Ctrl + Win + Up/Down/Right/Left tiles your window in 1/2 screen.
Shft + Win + Up/Down/Right/Left tiles your window in 1/4 screen on the top.
Alt  + Win + Up/Down/Right/Left tiles your window in 1/4 screen on the bottom.
Ctrl + Win + Alt shows your window spread & dashboard.
Scroll on the desktop to switch workspaces.
"

# Guake
/usr/bin/dconf write /org/guake/keybindings/global/show-hide "'Scroll_Lock'"
/usr/bin/dconf write /org/guake/general/window-refocus true
/usr/bin/dconf write /org/guake/general/window-vertical-displacement 40
/usr/bin/dconf write /org/guake/general/use-trayicon false
/usr/bin/dconf write /org/guake/general/start-at-login true
/usr/bin/dconf write /org/guake/general/prompt-on-quit false
/usr/bin/dconf write /org/guake/general/window-height 25
/usr/bin/dconf write /org/guake/general/use-popup false
/usr/bin/dconf write /org/guake/general/gtk-use-system-default-theme true
/usr/bin/dconf write /org/guake/style/font/palette-name "'Ollie'"

# X-Terminal Settings
## DropdownPositionVertical=0 makes trouble for F11 & F12 in combinations (fullscreen & show/hide)
/usr/bin/mkdir -p ~/.config/xfce4/terminal
/usr/bin/echo "[Configuration]
FontAllowBold=FALSE
MiscAlwaysShowTabs=FALSE
MiscBell=TRUE
MiscBellUrgent=FALSE
MiscBordersDefault=FALSE
MiscCursorBlinks=FALSE
MiscCursorShape=TERMINAL_CURSOR_SHAPE_BLOCK
MiscDefaultGeometry=80x23
MiscInheritGeometry=FALSE
MiscMenubarDefault=FALSE
MiscMouseAutohide=FALSE
MiscMouseWheelZoom=TRUE
MiscToolbarDefault=FALSE
MiscConfirmClose=TRUE
MiscCycleTabs=TRUE
MiscTabCloseButtons=TRUE
MiscTabCloseMiddleClick=TRUE
MiscTabPosition=GTK_POS_TOP
MiscHighlightUrls=TRUE
MiscMiddleClickOpensUri=TRUE
MiscCopyOnSelect=FALSE
MiscShowRelaunchDialog=TRUE
MiscRewrapOnResize=TRUE
MiscUseShiftArrowsToScroll=FALSE
MiscSlimTabs=TRUE
MiscNewTabAdjacent=FALSE
MiscSearchDialogOpacity=100
MiscShowUnsafePasteDialog=FALSE
MiscRightClickAction=TERMINAL_RIGHT_CLICK_ACTION_CONTEXT_MENU
BackgroundMode=TERMINAL_BACKGROUND_TRANSPARENT
BackgroundDarkness=0.780000
ColorPalette=#0c0d0e;#e31a1c;#31a354;#dca060;#3182bd;#756bb1;#80b1d3;#b7b8b9;#737475;#e31a1c;#31a354;#dca060;#3182bd;#756bb1;#80b1d3;#fcfdfe
DropdownWidth=100
DropdownHeight=25
DropdownStatusIcon=FALSE
FontName=Monospace 11
ShortcutsNoMnemonics=TRUE
ShortcutsNoMenukey=TRUE
ShortcutsNoHelpkey=TRUE
DropdownKeepOpenDefault=TRUE
DropdownToggleFocus=TRUE
DropdownPositionVertical=4
DropdownMoveToActive=TRUE
DropdownKeepAbove=TRUE
" > ~/.config/xfce4/terminal/terminalrc
wait
cat <<EOF > ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-terminal.xml
<?xml version="1.0" encoding="UTF-8"?>

<channel name="xfce4-terminal" version="1.0">
  <property name="background-mode" type="string" value="TERMINAL_BACKGROUND_TRANSPARENT"/>
  <property name="background-darkness" type="double" value="0.73999999999999999"/>
  <property name="misc-borders-default" type="bool" value="false"/>
  <property name="misc-show-unsafe-paste-dialog" type="bool" value="false"/>
  <property name="misc-middle-click-opens-uri" type="bool" value="true"/>
  <property name="dropdown-width" type="uint" value="100"/>
  <property name="dropdown-keep-open-default" type="bool" value="true"/>
  <property name="dropdown-toggle-focus" type="bool" value="true"/>
  <property name="dropdown-keep-above" type="bool" value="true"/>
  <property name="dropdown-status-icon" type="bool" value="false"/>
  <property name="color-foreground" type="string" value="#ffffff"/>
  <property name="color-background" type="string" value="#000000"/>
  <property name="color-background-vary" type="bool" value="false"/>
  <property name="color-cursor-foreground" type="string" value=""/>
  <property name="color-cursor" type="string" value=""/>
  <property name="color-cursor-use-default" type="bool" value="true"/>
  <property name="color-selection" type="string" value=""/>
  <property name="color-selection-background" type="string" value=""/>
  <property name="color-selection-use-default" type="bool" value="true"/>
  <property name="color-bold" type="string" value=""/>
  <property name="color-bold-use-default" type="bool" value="true"/>
  <property name="color-palette" type="string" value="#000000;#cc0000;#4e9a06;#c4a000;#3465a4;#75507b;#06989a;#d3d7cf;#555753;#ef2929;#8ae234;#fce94f;#739fcf;#ad7fa8;#34e2e2;#eeeeec"/>
  <property name="color-bold-is-bright" type="bool" value="true"/>
  <property name="color-use-theme" type="bool" value="false"/>
  <property name="tab-activity-color" type="string" value="#aa0000"/>
  <property name="dropdown-height" type="uint" value="33"/>
  <property name="dropdown-move-to-active" type="bool" value="false"/>
  <property name="dropdown-position-vertical" type="uint" value="4"/>
</channel>
EOF
wait

fi
# Xfce #


# Vrk configs
/usr/bin/sed -i "s/VRK_DESKTOP_SET=.*/VRK_DESKTOP_SET=\"YES\"/g" ~/.vrk/configs/stationinfo

# Finish
/usr/bin/echo "Enjoy Vrk Desktop settings. Login again to see them all. :-)
"
/usr/bin/sleep 2
